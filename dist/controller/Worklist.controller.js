sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Core","sap/ui/core/message/Message","sap/ui/core/library","sap/m/MessageBox","sap/m/ColumnListItem","sap/m/Label","sap/m/Token","sap/ui/core/Fragment","sap/m/MessageToast","wel/CreatePO/util/ErrorMessageController"],function(e,t,r,s,a,i,l,d,n,o,u,g,c,b,m){"use strict";var I="";var v="";var h="";var f="";var V="";var p=[];return e.extend("wel.CreatePO.controller.Worklist",{formatter:r,onInit:function(){var e=new sap.ui.model.json.JSONModel(sap.ui.Device);this.setModel(e,"device");this.getRouter().getRoute("worklist").attachPatternMatched(this.callModels,this)},callModels:function(){setTimeout(function(){$(".dateInputHide").find("input").attr("readonly",true)},200);var e=this;var r=this.formattingDate(new Date);this.getView().byId("idDocDate").setValue(r);this.getOwnerComponent().getModel().read("/UserNameSet",{success:function(e,t){I=e.results[0].Uname},error:function(){}});this.getOwnerComponent().getModel().read("/VendorListSet",{success:function(r,s){var a=new t(r);e.setModel(a,"VendorListModelName")},error:function(){}});this.getOwnerComponent().getModel().read("/PurchasingOrgsSet",{success:function(r,s){for(var a=0;a<r.results.length;a++){r.results[a].Ekotx=r.results[a].Ekotx+" "+"("+r.results[a].Ekorg+")"}var i=new t(r);i.setSizeLimit(1e3);e.setModel(i,"PurchasingOrgsSetName")},error:function(){}});this.getOwnerComponent().getModel().read("/PurchasingGrpsSet",{success:function(r,s){var a=new t(r);a.setSizeLimit(1e3);for(var i=0;i<r.results.length;i++){r.results[i].Eknam=r.results[i].Eknam+" "+"("+r.results[i].Ekgrp+")"}e.setModel(a,"PurchasingGrpsSetName")},error:function(){}});this.getOwnerComponent().getModel().read("/VendorCurrencySet",{success:function(r,s){var a=new t(r);a.setSizeLimit(1e3);for(var i=0;i<r.results.length;i++){r.results[i].Ltext=r.results[i].Ltext+" "+"("+r.results[i].Wears+")"}e.setModel(a,"VendorCurrencySetName")},error:function(){}});this.getOwnerComponent().getModel().read("/CompanyCodesSet",{success:function(r,s){var a=new t(r);a.setSizeLimit(1e3);for(var i=0;i<r.results.length;i++){r.results[i].Butxt=r.results[i].Butxt+" "+"("+r.results[i].Bukrs+")"}e.setModel(a,"CompanyCodesSetName")},error:function(){}});this.getOwnerComponent().getModel().read("/PersonalSettingsSet",{success:function(e,t){v=jQuery.extend(true,{},e)},error:function(e){}})},onValueHelpRequest:function(e){var t=this.getOwnerComponent().getModel();var r=this.getResourceBundle();this.selectVendorDialog=new sap.m.SelectDialog({title:r.getText("slctVndr"),items:{path:"/VendorListSet",template:new sap.m.StandardListItem({title:"{Name1}",description:"{Lifnr}"})},search:[this.onVendorSearch,this],confirm:[this.onVendorSelection,this],cancel:[this.onVendorDialogClose,this]});this.selectVendorDialog.setModel(t);this.selectVendorDialog.open()},onVendorSearch:function(e){var t="";var r=e.getParameter("value");if(r&&r.length>0){t=new s({filters:[new s({path:"Lifnr",operator:sap.ui.model.FilterOperator.Contains,value1:r}),new s({path:"Name1",operator:sap.ui.model.FilterOperator.Contains,value1:r})],and:true})}var a=e.getSource().getBinding("items");a.filter(t)},onVendorSelection:function(e){var r=this.byId("idVendor");var s="";var a=this;var i="";if(e.getParameter("selectedItem")){var l=e.getParameter("selectedItem").getDescription();s=e.getParameter("selectedContexts");s.map(function(e){i=e.getObject().Lifnr})}else{i=e.getSource().getProperty("value")}var d=new sap.ui.model.Filter({path:"Lifnr",operator:sap.ui.model.FilterOperator.EQ,value1:i});this.getOwnerComponent().getModel().read("/VendorListSet",{urlParameters:{$expand:"VendorPartnerNav"},filters:[d],success:function(e,r){if(e.results.length){var s=new t(e.results[0].VendorPartnerNav);if(!e.results[0].VendorPartnerNav.results.length){n.alert("No Partner/Partners available for"+" "+"("+i+")")}else{p=[];for(var l=0;l<e.results[0].VendorPartnerNav.results.length;l++){p.push(e.results[0].VendorPartnerNav.results[l])}}a.getView().byId("idVendor").setValue(e.results[0].Name1+" "+"("+e.results[0].Lifnr+")");a.setModel(s,"vendorPartnerModelName");a.getView().byId("idVendor").setValueState("None")}else{n.alert("No Vendor available for"+" "+"("+i+")");var d=new t([]);a.setModel(d,"vendorPartnerModelName");a.getView().byId("idVendor").setValueState("Error")}},error:function(e){n.alert("No Vendor available for"+" "+"("+i+")");var r=new t([]);a.setModel(r,"vendorPartnerModelName");a.getView().byId("idVendor").setValueState("Error")}});if(!l){r.resetProperty("value")}},onValueHelpOkPress:function(e){var t=e.getParameter("tokens");this._oInput.setSelectedKey(t[0].getKey());this._oValueHelpDialog.close()},onValueHelpCancelPress:function(){this._oValueHelpDialog.close()},onValueHelpAfterClose:function(){this._oValueHelpDialog.destroy()},ounValueHelpRequest:function(e){var t=this.getOwnerComponent().getModel();var r=this.getResourceBundle();this.selectVendorDialog=new sap.m.SelectDialog({title:r.getText("ordrUnit"),growing:false,items:{path:"/OrderUnitOfMeasureSet",template:new sap.m.StandardListItem({title:"{Msehl}",description:"{Msehi}"})},search:[this.onOunSearch,this],confirm:[this.ounSubmit,this],cancel:[this.onVendorDialogClose,this]});this.selectVendorDialog.setModel(t);this.selectVendorDialog.open()},onOunSearch:function(e){var t="";var r=e.getParameter("value");if(r&&r.length>0){t=new s({filters:[new s({path:"Msehi",operator:sap.ui.model.FilterOperator.Contains,value1:r}),new s({path:"Msehl",operator:sap.ui.model.FilterOperator.Contains,value1:r})],and:true})}var a=e.getSource().getBinding("items");a.filter(t)},ounSubmit:function(e){var t=this.byId("idOun");var r="";var s=this;var a="";var i="";if(e.getParameter("selectedItem")){var l=e.getParameter("selectedItem").getDescription();r=e.getParameter("selectedContexts");r.map(function(e){a=e.getObject().Msehi;i=e.getObject().Msehl});t.setValueState("None");t.setValue(i+" "+"("+a+")")}else{a=e.getSource().getProperty("value");var d=new sap.ui.model.Filter({path:"Msehi",operator:sap.ui.model.FilterOperator.EQ,value1:a});this.getOwnerComponent().getModel().read("/OrderUnitOfMeasureSet",{filters:[d],success:function(e,r){if(!e.results.length){n.alert("No Order Unit Of Measure available for"+" "+"("+a+")");t.setValueState("Error")}else{t.setValueState("None");s.getView().byId("idOun").setValue(e.results[0].Msehl+" "+"("+e.results[0].Msehi+")")}},error:function(e){n.alert("No Order Unit Of Measure available for"+" "+"("+a+")");t.setValueState("Error")}})}if(!l){t.resetProperty("value")}},mtrlGrpValueHelpRequest:function(e){var t=this.getOwnerComponent().getModel();var r=this.getResourceBundle();this.selectVendorDialog=new sap.m.SelectDialog({title:r.getText("mtrlGrp"),items:{path:"/MaterialGroupSet",template:new sap.m.StandardListItem({title:"{Wgbez}",description:"{Matkl}"})},search:[this.mtrlGrpSearch,this],confirm:[this.mtrlGrpSelection,this],cancel:[this.onVendorDialogClose,this]});this.selectVendorDialog.setModel(t);this.selectVendorDialog.open()},mtrlGrpSearch:function(e){var t="";var r=e.getParameter("value");if(r&&r.length>0){t=new s({filters:[new s({path:"Matkl",operator:sap.ui.model.FilterOperator.Contains,value1:r}),new s({path:"Wgbez",operator:sap.ui.model.FilterOperator.Contains,value1:r})],and:true})}var a=e.getSource().getBinding("items");a.filter(t)},mtrlGrpSelection:function(e){var t=this.byId("idMtrlGrp");var r="";var s=this;var a="";var i="";if(e.getParameter("selectedItem")){var l=e.getParameter("selectedItem").getDescription();r=e.getParameter("selectedContexts");r.map(function(e){a=e.getObject().Matkl;i=e.getObject().Wgbez});t.setValueState("None");t.setValue(i+" "+"("+a+")")}else{a=e.getSource().getProperty("value");var d=new sap.ui.model.Filter({path:"Matkl",operator:sap.ui.model.FilterOperator.EQ,value1:a});this.getOwnerComponent().getModel().read("/MaterialGroupSet",{filters:[d],success:function(e,r){if(!e.results.length){n.alert("No Material Group available for"+" "+"("+a+")");t.setValueState("Error")}else{t.setValueState("None");s.getView().byId("idMtrlGrp").setValue(e.results[0].Wgbez+" "+"("+e.results[0].Matkl+")")}},error:function(e){n.alert("No Material Group available for"+" "+"("+a+")");t.setValueState("Error")}})}if(!l){t.resetProperty("value")}},glAccValueHelpRequest:function(e){var t=this.getOwnerComponent().getModel();var r=this.getResourceBundle();this.selectVendorDialog=new sap.m.SelectDialog({title:r.getText("glAccnt"),growing:false,items:{path:"/GLAccountSet",template:new sap.m.StandardListItem({title:"{Txt50}",description:"{Sakto}"})},search:[this.glAccSearch,this],confirm:[this.glAccSubmit,this],cancel:[this.onVendorDialogClose,this]});this.selectVendorDialog.setModel(t);this.selectVendorDialog.open()},glAccSearch:function(e){var t="";var r=e.getParameter("value");if(r&&r.length>0){t=new s({filters:[new s({path:"Sakto",operator:sap.ui.model.FilterOperator.Contains,value1:r}),new s({path:"Txt50",operator:sap.ui.model.FilterOperator.Contains,value1:r})],and:true})}var a=e.getSource().getBinding("items");a.filter(t)},glAccSubmit:function(e){var t=this.byId("idGlAcc");var r="";var s=this;var a="";var i="";if(e.getParameter("selectedItem")){var l=e.getParameter("selectedItem").getDescription();r=e.getParameter("selectedContexts");r.map(function(e){a=e.getObject().Sakto;i=e.getObject().Txt50});t.setValueState("None");t.setValue(i+" "+"("+a+")")}else{a=e.getSource().getProperty("value");var d=new sap.ui.model.Filter({path:"Sakto",operator:sap.ui.model.FilterOperator.EQ,value1:a});this.getOwnerComponent().getModel().read("/GLAccountSet",{filters:[d],success:function(e,r){if(!e.results.length){n.alert("No GLAccount available for"+" "+"("+a+")");t.setValueState("Error")}else{t.setValueState("None");s.getView().byId("idGlAcc").setValue(e.results[0].Txt50+" "+"("+e.results[0].Sakto+")")}},error:function(e){n.alert("No GLAccount available for"+" "+"("+a+")");t.setValueState("Error")}})}if(!l){t.resetProperty("value")}},cstCntreValueHelpRequest:function(e){var t=this.getOwnerComponent().getModel();var r=this.getResourceBundle();this.selectVendorDialog=new sap.m.SelectDialog({title:r.getText("cstCntr"),items:{path:"/CostCenterSet",template:new sap.m.StandardListItem({title:"{Ltext}",description:"{Kostl}"})},search:[this.cstCntreSearch,this],confirm:[this.cstCntreSubmit,this],cancel:[this.onVendorDialogClose,this]});this.selectVendorDialog.setModel(t);this.selectVendorDialog.open()},cstCntreSearch:function(e){var t="";var r=e.getParameter("value");if(r&&r.length>0){t=new s({filters:[new s({path:"Kostl",operator:sap.ui.model.FilterOperator.Contains,value1:r}),new s({path:"Ltext",operator:sap.ui.model.FilterOperator.Contains,value1:r})],and:true})}var a=e.getSource().getBinding("items");a.filter(t)},cstCntreSubmit:function(e){var t=this.byId("idCstCntre");var r="";var s=this;var a="";var i="";if(e.getParameter("selectedItem")){var l=e.getParameter("selectedItem").getDescription();r=e.getParameter("selectedContexts");r.map(function(e){a=e.getObject().Kostl;i=e.getObject().Ltext});t.setValueState("None");t.setValue(i+" "+"("+a+")")}else{a=e.getSource().getProperty("value");var d=new sap.ui.model.Filter({path:"Kostl",operator:sap.ui.model.FilterOperator.EQ,value1:a});this.getOwnerComponent().getModel().read("/CostCenterSet",{filters:[d],success:function(e,r){if(!e.results.length){n.alert("No CostCenter available for"+" "+"("+a+")");t.setValueState("Error")}else{t.setValueState("None");s.getView().byId("idCstCntre").setValue(e.results[0].Ltext+" "+"("+e.results[0].Kostl+")")}},error:function(e){n.alert("No CostCenter available for"+" "+"("+a+")");t.setValueState("Error")}})}if(!l){t.resetProperty("value")}},ordrValueHelpRequest:function(e){var t=this.getOwnerComponent().getModel();var r=this.getResourceBundle();this.selectVendorDialog=new sap.m.SelectDialog({title:r.getText("ordrNum"),items:{path:"/OrderNumberRefSet",template:new sap.m.StandardListItem({title:"{Ktext}",description:"{Aufnr}"})},search:[this.ordNumbrSearch,this],confirm:[this.ordrSubmit,this],cancel:[this.onVendorDialogClose,this]});this.selectVendorDialog.setModel(t);this.selectVendorDialog.open()},ordNumbrSearch:function(e){var t="";var r=e.getParameter("value");if(r&&r.length>0){t=new s({filters:[new s({path:"Aufnr",operator:sap.ui.model.FilterOperator.Contains,value1:r}),new s({path:"Ktext",operator:sap.ui.model.FilterOperator.Contains,value1:r})],and:true})}var a=e.getSource().getBinding("items");a.filter(t)},ordrSubmit:function(e){var t=this.byId("idOrdr");var r="";var s=this;var a="";var i="";if(e.getParameter("selectedItem")){var l=e.getParameter("selectedItem").getDescription();r=e.getParameter("selectedContexts");r.map(function(e){a=e.getObject().Aufnr;i=e.getObject().Ktext});t.setValueState("None");t.setValue(i+" "+"("+a+")")}else{a=e.getSource().getProperty("value");var d=new sap.ui.model.Filter({path:"Aufnr",operator:sap.ui.model.FilterOperator.EQ,value1:a});this.getOwnerComponent().getModel().read("/OrderNumberRefSet",{filters:[d],success:function(e,r){if(!e.results.length){n.alert("No Order Number available for"+" "+"("+a+")");t.setValueState("Error")}else{t.setValueState("None");s.getView().byId("idOrdr").setValue(e.results[0].Ktext+" "+"("+e.results[0].Aufnr+")")}},error:function(e){n.alert("No Order Number available for"+" "+"("+a+")");t.setValueState("Error")}})}if(!l){t.resetProperty("value")}},gbsValueHelpRequest:function(e){var t=this.getOwnerComponent().getModel();var r=this.getResourceBundle();this.selectVendorDialog=new sap.m.SelectDialog({title:r.getText("wbsElmnt"),items:{path:"/WBSElementSet",template:new sap.m.StandardListItem({title:"{Post1}",description:"{Posid}"})},search:[this.onWBSSearch,this],confirm:[this.gbsSubmit,this],cancel:[this.onVendorDialogClose,this]});this.selectVendorDialog.setModel(t);this.selectVendorDialog.open()},onWBSSearch:function(e){var t="";var r=e.getParameter("value");if(r&&r.length>0){t=new s({filters:[new s({path:"Posid",operator:sap.ui.model.FilterOperator.Contains,value1:r}),new s({path:"Post1",operator:sap.ui.model.FilterOperator.Contains,value1:r})],and:true})}var a=e.getSource().getBinding("items");a.filter(t)},gbsSubmit:function(e){var t=this.byId("idGbs");var r="";var s=this;var a="";var i="";if(e.getParameter("selectedItem")){var l=e.getParameter("selectedItem").getDescription();r=e.getParameter("selectedContexts");r.map(function(e){a=e.getObject().Posid;i=e.getObject().Post1});t.setValueState("None");t.setValue(i+" "+"("+a+")")}else{a=e.getSource().getProperty("value");var d=new sap.ui.model.Filter({path:"Posid",operator:sap.ui.model.FilterOperator.EQ,value1:a});this.getOwnerComponent().getModel().read("/WBSElementSet",{filters:[d],success:function(e,r){if(!e.results.length){n.alert("No WBS Element available for"+" "+"("+a+")");t.setValueState("Error")}else{t.setValueState("None");s.getView().byId("idGbs").setValue(e.results[0].Post1+" "+"("+e.results[0].Posid+")")}},error:function(e){n.alert("No WBS Element available for"+" "+"("+a+")");t.setValueState("Error")}})}if(!l){t.resetProperty("value")}},onVndValueHelpRequest:function(e){var t=this.getOwnerComponent().getModel();var r=this.getResourceBundle();var s=this.getView().byId("idFunct").getValue();var a="";var i=[];if(s){var l=new sap.ui.model.Filter({path:"Parvw",operator:sap.ui.model.FilterOperator.EQ,value1:s});i.push(l)}if(s==="ZA"){a="";a=r.getText("slctApprvngMngr")}else{a="";a=r.getText("slctVndr")}this.selectVendorDialog=new sap.m.SelectDialog({title:a,items:{path:"/PersonVendorListSet",filters:i,template:new sap.m.StandardListItem({title:"{Name1}",description:"{Lifnr}"})},search:[this.onVndSearch,this],confirm:[this.onVndSelection,this],cancel:[this.onVendorDialogClose,this]});this.selectVendorDialog.setModel(t);this.selectVendorDialog.open()},onVndSearch:function(e){var t="";var r=e.getParameter("value");var a=this.getView().byId("idFunct").getValue();var i=[];if(r&&r.length>0){t=new s({filters:[new s({path:"Lifnr",operator:sap.ui.model.FilterOperator.Contains,value1:r}),new s({path:"Name1",operator:sap.ui.model.FilterOperator.Contains,value1:r})],and:true});if(!a){var l=new s({path:"Parvw",operator:sap.ui.model.FilterOperator.Contains,value1:r});t.aFilters.push(l)}i.push(t)}var d=e.getSource().getBinding("items");d.filter(i)},onVndSelection:function(e){var t=this.byId("idVendorName");var r=this.byId("idNumber");var s="";var a=this;var i="";var l="";var d="";if(e.getParameter("selectedItem")){var o=e.getParameter("selectedItem").getDescription();s=e.getParameter("selectedContexts");s.map(function(e){i=e.getObject().Lifnr;l=e.getObject().Name1});t.setValueState("None");r.setValueState("None");t.setValue(l);r.setValue(i)}else{i=e.getSource().getProperty("value");d=this.getView().byId("idFunct").getValue();var u=new sap.ui.model.Filter({path:"Lifnr",operator:sap.ui.model.FilterOperator.EQ,value1:i});var g=new sap.ui.model.Filter({path:"Parvw",operator:sap.ui.model.FilterOperator.EQ,value1:d});this.getOwnerComponent().getModel().read("/PersonVendorListSet",{filters:[u,g],success:function(e,s){if(!e.results.length){n.alert("No Vendor available for"+" "+"("+i+")");t.setValueState("Error");r.setValueState("Error")}else{t.setValueState("None");r.setValueState("None");a.getView().byId("idVendorName").setValue(e.results[0].Lifnr);a.getView().byId("idVendorName").setValue(e.results[0].Name1)}},error:function(e){n.alert("No Vendor available for"+" "+"("+i+")");t.setValueState("Error");r.setValueState("Error")}})}if(!o){t.resetProperty("value")}},commnChange:function(e){var t=this.getView();var r=e.getParameters().value;var s=r;if(e.getSource().getId().includes("idOun")){t.byId("idOun").setValueState("None")}else if(e.getSource().getId().includes("idMtrlGrp")){t.byId("idMtrlGrp").setValueState("None")}else if(e.getSource().getId().includes("idGlAcc")){t.byId("idGlAcc").setValueState("None")}else if(e.getSource().getId().includes("idCstCntre")){t.byId("idCstCntre").setValueState("None")}else if(e.getSource().getId().includes("idOrdr")){t.byId("idOrdr").setValueState("None")}else if(e.getSource().getId().includes("idGbs")){t.byId("idGbs").setValueState("None")}else if(e.getSource().getId().includes("idVendor")){t.byId("idVendor").setValueState("None")}if(s){e.getSource().setValue(s)}else{e.getSource().setDOMValue("")}},onAddItemPress:function(){var e=this.getView();e.byId("idAddItem").setVisible(true);e.byId("idUpdateItem").setVisible(false);e.byId("idItemSubSection").setVisible(false);e.byId("idPartnersSubSection").setVisible(false);e.byId("idAddNewItem").setVisible(true);e.byId("idItem").setValue("");e.byId("idAccAGnmnt").setValue("");e.byId("idAccAGnmnt").setValueState("None");e.byId("idShrtTxt").setValue("");e.byId("idShrtTxt").setValueState("None");e.byId("idPoQty").setValue("");e.byId("idPoQty").setValueState("None");e.byId("idOun").setValue("");e.byId("idOun").setValueState("None");e.byId("idNetPrice").setValue("");e.byId("idNetPrice").setValueState("None");e.byId("idDelvDt").setValue("");e.byId("idDelvDt").setValueState("None");e.byId("idMtrlGrp").setValue("");e.byId("idMtrlGrp").setValueState("None");e.byId("idGlAcc").setValue("");e.byId("idGlAcc").setValueState("None");e.byId("idCstCntre").setValue("");e.byId("idCstCntre").setValueState("None");e.byId("idOrdr").setValue("");e.byId("idOrdr").setValueState("None");e.byId("idGbs").setValue("");e.byId("idGbs").setValueState("None")},nullCheck:function(e){if(e){return e}else{return""}},onAddItem:function(e){var r=this.getView();var s={results:[]};var a=0;var i=r.byId("idItemsTable").getModel("itemTableModelName");var l=true;var d=this.getResourceBundle();var o=[r.byId("idAccAGnmnt"),r.byId("idShrtTxt"),r.byId("idPoQty"),r.byId("idOun"),r.byId("idNetPrice"),r.byId("idDelvDt"),r.byId("idMtrlGrp"),r.byId("idGlAcc"),r.byId("idCstCntre"),r.byId("idOrdr"),r.byId("idGbs")];jQuery.each(o,function(e,t){if(t.getValue()&&t.getProperty("visible")){t.setValueState("None")}else if(!t.getValue()&&t.getProperty("visible")){t.setValueState("Error");l=false}});if(!l){n.alert(d.getText("plsFillUp"))}else{if(this.mandtFldValidationCheck()){var u={Item:r.byId("idItem").getValue(),AccAssgmt:r.byId("idAccAGnmnt").getSelectedItem().getText(),ShortText:r.byId("idShrtTxt").getValue(),POQty:r.byId("idPoQty").getValue(),OUn:r.byId("idOun").getValue(),NetPrice:r.byId("idNetPrice").getValue(),DelivDate:r.byId("idDelvDt").getValue(),MatlGroup:r.byId("idMtrlGrp").getValue(),GL:r.byId("idGlAcc").getValue(),CostCenter:this.nullCheck(r.byId("idCstCntre").getValue()),Order:this.nullCheck(r.byId("idOrdr").getValue()),Gbs:this.nullCheck(r.byId("idGbs").getValue()),selected:false};if(v){for(var g=0;g<v.results.length;g++){if(v.results[g].Element.includes("WAERS"))u.NetPrice=u.NetPrice+" "+v.results[g].Active}}else if(h){for(var c=0;c<h.PerSetHdToItmNav.results.length;c++){if(h.PerSetHdToItmNav.results[c].Element.includes("WAERS"))u.NetPrice=u.NetPrice+" "+h.PerSetHdToItmNav.results[c].Active}}u.POQty=u.POQty+" "+u.OUn.split("(")[1].split(")")[0];r.byId("idItemSubSection").setVisible(true);r.byId("idPartnersSubSection").setVisible(true);r.byId("idAddNewItem").setVisible(false);if(r.byId("idItemsTable").getItems().length>0){i.getData().results.push(u);for(var m=0;m<i.getData().results.length;m++){a=a+parseFloat(i.getData().results[m].NetPrice)}r.byId("idPoNetValue").setText(a+" "+i.getData().results[0].NetPrice.split(" ")[1]);u={};if(r.byId("idItemsTable").getColumns()[0].mAggregations.header.getSelected()){r.byId("idItemsTable").getColumns()[0].mAggregations.header.setSelected(false)}i.refresh()}else{s.results.push(u);var I=new t(s);for(var f=0;f<s.results.length;f++){a=a+parseFloat(s.results[f].NetPrice)}r.byId("idPoNetValue").setText(a+" "+s.results[0].NetPrice.split(" ")[1]);this.setModel(I,"itemTableModelName");u={}}b.show(d.getText("itmAddedSuccessfully"))}else{n.alert(d.getText("plsSelect"))}}},onAddItemCancel:function(){var e=this.getView();e.byId("idItemSubSection").setVisible(true);e.byId("idPartnersSubSection").setVisible(true);e.byId("idAddNewItem").setVisible(false);e.byId("idAddPartner").setVisible(false)},onCheckPress2:function(e){var t=new sap.m.MessagePopoverItem({type:"{type}",title:"{title}",description:"{description}"});var r=new sap.m.MessagePopover({items:{path:"/",template:t}});var s=[{type:"Error",title:"1 Error message",description:"First Error message description"},{type:"Warning",title:"1 Warning without description",description:""},{type:"Success",title:"1 Success message",description:"First Success message description"},{type:"Error",title:"2 Error message",description:"Second Error message description"},{type:"Information",title:"1 Information message",description:"First Information message description"}];var a=new sap.ui.model.json.JSONModel;a.setData(s);var i=new sap.ui.model.json.JSONModel;i.setData({messagesLength:s.length+""});this.getView().setModel(i,"viewProperties");r.setModel(a);r.openBy(e.getSource())},onPersonalSettingsPress:function(e){this.openPersonalSettingsDialog().open();var t=sap.ui.getCore();for(var r=0;r<v.results.length;r++){if(v.results[r].Element.includes("EKORG")){t.byId("idPurchOrg").setSelectedKey(v.results[r].Active)}else if(v.results[r].Element.includes("EKGRP")){t.byId("idPurchGrp").setSelectedKey(v.results[r].Active)}else if(v.results[r].Element.includes("WAERS")){t.byId("idCurrency").setSelectedKey(v.results[r].Active)}else if(v.results[r].Element.includes("BUKRS")){t.byId("idCompCode").setSelectedKey(v.results[r].Active)}}},openPersonalSettingsDialog:function(){var e=this;if(!e.personalSettingsDialog){e.personalSettingsDialog=sap.ui.xmlfragment("wel.CreatePO.fragments.PersonalSettings",e);e.getView().addDependent(e.personalSettingsDialog)}return this.personalSettingsDialog},onPersonalSettingsDialogClose:function(){this.openPersonalSettingsDialog().close()},onAddPartnerPress:function(){var e=this.getView();e.byId("idItemSubSection").setVisible(false);e.byId("idPartnersSubSection").setVisible(false);e.byId("idAddNewItem").setVisible(false);e.byId("idUpdatePartnerButton").setVisible(false);e.byId("idAddPartner").setVisible(true);e.byId("idAddPartnerButton").setVisible(true);e.byId("idFunct").setValue("");e.byId("idName").setValue("");e.byId("idNumber").setValue("");e.byId("idVendorName").setValue("")},formattingDate:function(e){if(e){var t=new Date(e);var r=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM/dd/yyyy"});var s=r.format(t);return s}},itemTableSelectionChange:function(e){var t=this.getView();this.selectedItemIndex="";t.byId("idAddItem").setVisible(false);t.byId("idUpdateItem").setVisible(true);this.selectedItemIndex=e.getSource().getSelectedContextPaths()[0].split("/")[2];var r=t.byId("idItemsTable").getModel("itemTableModelName").getData().results[this.selectedItemIndex];t.byId("idItemSubSection").setVisible(false);t.byId("idPartnersSubSection").setVisible(false);if(r.AccAssgmt.split("(")[0].trim()==="F"){t.byId("idGbsLbl").setVisible(false);t.byId("idGbs").setVisible(false);t.byId("idOrdLbl").setVisible(true);t.byId("idOrdr").setVisible(true);t.byId("idCstCntreLbl").setVisible(true);t.byId("idCstCntre").setVisible(true)}else if(r.AccAssgmt.split("(")[0].trim()==="K"){t.byId("idOrdLbl").setVisible(false);t.byId("idOrdr").setVisible(false);t.byId("idGbsLbl").setVisible(false);t.byId("idGbs").setVisible(false);t.byId("idCstCntreLbl").setVisible(true);t.byId("idCstCntre").setVisible(true)}else{t.byId("idOrdLbl").setVisible(false);t.byId("idOrdr").setVisible(false);t.byId("idCstCntreLbl").setVisible(false);t.byId("idCstCntre").setVisible(false);t.byId("idGbsLbl").setVisible(true);t.byId("idGbs").setVisible(true)}t.byId("idAddNewItem").setVisible(true);t.byId("idAccAGnmnt").setValue(r.AccAssgmt);t.byId("idItem").setValue(r.Item);t.byId("idShrtTxt").setValue(r.ShortText);t.byId("idPoQty").setValue(r.POQty.split(" ")[0]);t.byId("idOun").setValue(r.OUn);t.byId("idNetPrice").setValue(r.NetPrice.split(" ")[0]);t.byId("idDelvDt").setValue(this.formattingDate(r.DelivDate));t.byId("idMtrlGrp").setValue(r.MatlGroup);t.byId("idGlAcc").setValue(r.GL);t.byId("idCstCntre").setValue(r.CostCenter);t.byId("idOrdr").setValue(r.Order);t.byId("idGbs").setValue(r.Gbs);e.getSource().getSelectedItem().setSelected(false)},checkSelectedValue:function(e){if(e){return e.getText()}else{return""}},onUpdateItem:function(){var e=this.getView();var r=this.selectedItemIndex;var s=true;var a=this.getResourceBundle();var i=[e.byId("idAccAGnmnt"),e.byId("idShrtTxt"),e.byId("idPoQty"),e.byId("idOun"),e.byId("idNetPrice"),e.byId("idDelvDt"),e.byId("idMtrlGrp"),e.byId("idGlAcc"),e.byId("idCstCntre"),e.byId("idOrdr"),e.byId("idGbs")];jQuery.each(i,function(e,t){if(t.getValue()&&t.getProperty("visible")){t.setValueState("None")}else if(!t.getValue()&&t.getProperty("visible")){t.setValueState("Error");s=false}});if(!s){n.alert(a.getText("plsFillUp"))}else{if(this.mandtFldValidationCheck()){var l={Item:e.byId("idItem").getValue(),AccAssgmt:e.byId("idAccAGnmnt").getValue(),ShortText:e.byId("idShrtTxt").getValue(),POQty:e.byId("idPoQty").getValue(),OUn:e.byId("idOun").getValue(),NetPrice:e.byId("idNetPrice").getValue(),DelivDate:e.byId("idDelvDt").getValue(),MatlGroup:e.byId("idMtrlGrp").getValue(),GL:e.byId("idGlAcc").getValue(),CostCenter:this.nullCheck(e.byId("idCstCntre").getValue()),Order:this.nullCheck(e.byId("idOrdr").getValue()),Gbs:this.nullCheck(e.byId("idGbs").getValue())};if(v){for(var d=0;d<v.results.length;d++){if(v.results[d].Element.includes("WAERS"))l.NetPrice=l.NetPrice+" "+v.results[d].Active}}else if(h){for(var o=0;o<h.PerSetHdToItmNav.results.length;o++){if(h.PerSetHdToItmNav.results[o].Element.includes("WAERS"))l.NetPrice=l.NetPrice+" "+h.PerSetHdToItmNav.results[o].Active}}l.POQty=l.POQty+" "+l.OUn.split("(")[1].split(")")[0];if(e.byId("idItemsTable").getColumns()[0].mAggregations.header.getSelected()){e.byId("idItemsTable").getColumns()[0].mAggregations.header.setSelected(false)}e.byId("idItemsTable").getModel("itemTableModelName").getData().results.splice(r,1);e.byId("idItemsTable").getModel("itemTableModelName").getData().results.splice(r,0,l);var u=new t(e.byId("idItemsTable").getModel("itemTableModelName").getData());this.setModel(u,"itemTableModelName");var g=0;for(var c=0;c<this.getView().byId("idItemsTable").getModel("itemTableModelName").getData().results.length;c++){g=g+parseFloat(this.getView().byId("idItemsTable").getModel("itemTableModelName").getData().results[c].NetPrice)}g=g+" "+this.getView().byId("idItemsTable").getModel("itemTableModelName").getData().results[this.selectedItemIndex].NetPrice.split(" ")[1];this.getView().byId("idPoNetValue").setText(g);l={};this.selectedItemIndex="";e.byId("idItemSubSection").setVisible(true);e.byId("idPartnersSubSection").setVisible(true);e.byId("idAddNewItem").setVisible(false);e.byId("idAddPartner").setVisible(false)}else{n.alert(a.getText("plsSelect"))}}},selectAllRows:function(e){var t=this.getView().byId("idItemsTable").getModel("itemTableModelName").getData();if(e.getSource().getParent().getParent().mAggregations.columns[0].getHeader().getSelected()){for(var r=0;r<t.results.length;r++){this.getView().byId("idItemsTable").getItems()[r].mAggregations.cells[0].setSelected(true)}}else{for(var s=0;s<t.results.length;s++){this.getView().byId("idItemsTable").getItems()[s].mAggregations.cells[0].setSelected(false)}}},selectSingleRow:function(e){var t=this.getView().byId("idItemsTable").getItems();var r=false;for(var s=0;s<t.length;s++){if(this.getView().byId("idItemsTable").getItems()[s].mAggregations.cells[0].getSelected()){r=true}else{r=false;break}}if(r){e.getSource().getParent().getParent().mAggregations.columns[0].getHeader().setSelected(true)}else{e.getSource().getParent().getParent().mAggregations.columns[0].getHeader().setSelected(false)}},copyItemsFromItemTable:function(e){var t=true;var r=0;var s=[];if(this.getView().byId("idItemsTable").getItems().length){var a=this.getView().byId("idItemsTable").getModel("itemTableModelName").getData();for(var i=0;i<a.results.length;i++){if(a.results[i].selected){s.push(a.results[i])}}if(s.length){var l="";l=jQuery.extend(true,{},s);for(var d=0;d<s.length;d++){l[d].selected=false;a.results.push(l[d])}for(var o=0;o<a.results.length;o++){r=r+parseInt(a.results[o].NetPrice)}r=r+" "+a.results[0].NetPrice.split(" ")[1];this.getView().byId("idPoNetValue").setText(r);this.getView().byId("idItemsTable").mAggregations.columns[0].getHeader().setSelected(false);this.getView().byId("idItemsTable").getModel("itemTableModelName").refresh()}else{n.alert("Please select item from the table.")}}else{n.alert("Please add item to the table.")}},onDeleteItem:function(e){var t=true;var r=[];var s=this.getView();var a=this.getResourceBundle();var i=s.byId("idItemsTable");var l="";var d="";var o=s.byId("idPoNetValue").getText();var u="";var g="";if(i.getItems().length){d=i.getModel("itemTableModelName");l=i.getModel("itemTableModelName").getData().results;for(var c=0;c<l.length;c++){if(l[c].selected){r.push(l[c])}}if(r.length){for(var b=l.length-1;b>=0;b--){g="";if(l[b].selected){o=parseFloat(o)-parseFloat(l[b].NetPrice);g=l[b].NetPrice.split(" ")[1];l.splice(b,1)}}u=parseFloat(o)+" "+g;s.byId("idPoNetValue").setText(u);s.byId("idItemsTable").mAggregations.columns[0].getHeader().setSelected(false);d.refresh()}else{n.alert("Please select record from the table.")}}else{n.alert("Please add record to the table.")}},addPartnerMandtFldChk:function(e){var t=this.getView();var r=true;var s=this.getResourceBundle();var a=[t.byId("idFunct"),t.byId("idNumber")];jQuery.each(a,function(e,t){if(t.getValue()){t.setValueState("None")}else if(!t.getValue()){t.setValueState("Error");r=false}});return r},onAddPartner:function(e){var r=this;var s=this.getView();var a=true;var i=this.getResourceBundle();var l=[s.byId("idFunct"),s.byId("idName"),s.byId("idNumber"),s.byId("idVendorName")];jQuery.each(l,function(e,t){if(t.getValue()){t.setValueState("None")}else if(!t.getValue()){t.setValueState("Error");a=false}});if(!a){n.alert(i.getText("plsFillUp"))}else{if(this.addPartnerMandtFldChk()){s.byId("idAddNewItem").setVisible(false);var d=s.byId("idPartnersTable").getModel("vendorPartnerModelName");var o=this.getView().byId("idFunct").getValue();var u=this.getView().byId("idNumber").getValue();var g=new sap.ui.model.Filter({path:"Lifnr",operator:sap.ui.model.FilterOperator.EQ,value1:u});var c=new sap.ui.model.Filter({path:"Parvw",operator:sap.ui.model.FilterOperator.EQ,value1:o});this.getOwnerComponent().getModel().read("/PartnerFunctionCheckSet",{filters:[g,c],success:function(e,a){if(!e.results[0].Vtext){var l={results:[]};var o={Parvw:s.byId("idFunct").getValue(),Name1:s.byId("idName").getValue(),Lifnr:s.byId("idNumber").getValue(),Vtext:s.byId("idVendorName").getValue(),selected:false};if(s.byId("idPartnersTable").getItems().length>0){d.getData().results.push(o);o={};d.refresh()}else{l.results.push(o);var u=new t(l);r.setModel(u,"vendorPartnerModelName");o={}}if(s.byId("idPartnersTable").getColumns()[0].mAggregations.header.getSelected()){s.byId("idPartnersTable").getColumns()[0].mAggregations.header.setSelected(false)}s.byId("idItemSubSection").setVisible(true);s.byId("idAddPartner").setVisible(false);s.byId("idPartnersSubSection").setVisible(true);b.show(i.getText("prntrAddedSuccessfully"))}else{n.error(e.results[0].Vtext)}},error:function(){}})}else{n.alert("Please fillup mandatory fields.")}}},connonInputFieldStateChange:function(e){var t=this.getView();if(e.getSource().getId().includes("idName")){t.byId("idName").setValueState("None")}else if(e.getSource().getId().includes("idVendorName")){t.byId("idVendorName").setValueState("None")}var r=e.getParameters().value;var s=r;if(s){e.getSource().setValue(s)}else{e.getSource().setDOMValue("")}},onPartnerCancel:function(e){var t=this.getView();t.byId("idItemSubSection").setVisible(true);t.byId("idPartnersSubSection").setVisible(true);t.byId("idAddNewItem").setVisible(false);t.byId("idAddPartner").setVisible(false)},partnerTableSelectionChange:function(e){var t=this.getView();this.partnerTableSelectedItemIndex="";t.byId("idAddPartnerButton").setVisible(false);t.byId("idUpdatePartnerButton").setVisible(true);this.partnerTableSelectedItemIndex=e.getSource().getSelectedContextPaths()[0].split("/")[2];var r=t.byId("idPartnersTable").getModel("vendorPartnerModelName").getData().results[this.partnerTableSelectedItemIndex];t.byId("idItemSubSection").setVisible(false);t.byId("idAddNewItem").setVisible(false);t.byId("idPartnersSubSection").setVisible(false);t.byId("idAddPartner").setVisible(true);t.byId("idFunct").setValue(r.Parvw);t.byId("idName").setValue(r.Name1);t.byId("idNumber").setValue(r.Lifnr);t.byId("idVendorName").setValue(r.Vtext);e.getSource().getSelectedItem().setSelected(false)},onUpdatePartner:function(){var e=this;var r=this.getView();var s=true;var a=this.getResourceBundle();var i=[r.byId("idFunct"),r.byId("idName"),r.byId("idNumber"),r.byId("idVendorName")];jQuery.each(i,function(e,t){if(t.getValue()){t.setValueState("None")}else if(!t.getValue()){t.setValueState("Error");s=false}});if(!s){n.alert(a.getText("plsFillUp"))}else{var l=this.partnerTableSelectedItemIndex;var d=this.getView().byId("idFunct").getValue();var o=this.getView().byId("idNumber").getValue();var u=new sap.ui.model.Filter({path:"Lifnr",operator:sap.ui.model.FilterOperator.EQ,value1:o});var g=new sap.ui.model.Filter({path:"Parvw",operator:sap.ui.model.FilterOperator.EQ,value1:d});this.getOwnerComponent().getModel().read("/PartnerFunctionCheckSet",{filters:[u,g],success:function(s,i){if(s.results[0].Vtext==="1"){var d={Parvw:r.byId("idFunct").getValue(),Name1:r.byId("idName").getValue(),Lifnr:r.byId("idNumber").getValue(),Vtext:r.byId("idVendorName").getValue()};if(r.byId("idPartnersTable").getColumns()[0].mAggregations.header.getSelected()){r.byId("idPartnersTable").getColumns()[0].mAggregations.header.setSelected(false)}r.byId("idPartnersTable").getModel("vendorPartnerModelName").getData().results.splice(l,1);r.byId("idPartnersTable").getModel("vendorPartnerModelName").getData().results.splice(l,0,d);var o=new t(r.byId("idPartnersTable").getModel("vendorPartnerModelName").getData());e.setModel(o,"vendorPartnerModelName");d={};e.partnerTableSelectedItemIndex="";r.byId("idItemSubSection").setVisible(true);r.byId("idPartnersSubSection").setVisible(true);r.byId("idAddNewItem").setVisible(false);r.byId("idAddPartner").setVisible(false)}else{n.error(a.getText("prtnr")+" "+s.results[0].Parvw+" "+a.getText("and")+" "+a.getText("vndr")+" "+s.results[0].Lifnr+" "+a.getText("arMismatchd"));r.byId("idAddNewItem").setVisible(false)}},error:function(e){}})}},selectPartnerAllRows:function(e){var t=this.getView().byId("idPartnersTable");if(t.getItems().length){var r=t.getModel("vendorPartnerModelName").getData();if(e.getSource().getParent().getParent().mAggregations.columns[0].getHeader().getSelected()){for(var s=0;s<r.results.length;s++){this.getView().byId("idPartnersTable").getItems()[s].mAggregations.cells[0].setSelected(true)}}else{for(var a=0;a<r.results.length;a++){this.getView().byId("idPartnersTable").getItems()[a].mAggregations.cells[0].setSelected(false)}}}},selectPartnerSingleRow:function(e){var t=this.getView().byId("idPartnersTable").getItems();var r=false;for(var s=0;s<t.length;s++){if(this.getView().byId("idPartnersTable").getItems()[s].mAggregations.cells[0].getSelected()){r=true}else{r=false;break}}if(r){e.getSource().getParent().getParent().mAggregations.columns[0].getHeader().setSelected(true)}else{e.getSource().getParent().getParent().mAggregations.columns[0].getHeader().setSelected(false)}},onDeletePartner:function(e){var t=true;var r=[];var s=this.getView();var a=this.getResourceBundle();var i=s.byId("idPartnersTable");var l="";var d="";if(i.getItems().length){d=i.getModel("vendorPartnerModelName");l=i.getModel("vendorPartnerModelName").getData().results;for(var o=0;o<l.length;o++){if(l[o].selected){r.push(l[o])}}if(r.length){for(var u=l.length-1;u>=0;u--){if(l[u].selected){l.splice(u,1)}}s.byId("idPartnersTable").mAggregations.columns[0].getHeader().setSelected(false);d.refresh()}else{n.alert("Please select record from the table.")}}else{n.alert("Please add record to the table.")}},AccAssgnmntSelectionChange:function(e){var t=this.getView();t.byId("idAccAGnmnt").setValueState("None");if(e.getSource().getSelectedItem().getKey()==="F"){t.byId("idGbsLbl").setVisible(false);t.byId("idGbs").setVisible(false);if(t.byId("idGbs").getValue()){t.byId("idGbs").setValue("")}t.byId("idOrdLbl").setVisible(true);t.byId("idOrdr").setVisible(true);t.byId("idCstCntreLbl").setVisible(true);t.byId("idCstCntre").setVisible(true)}else if(e.getSource().getSelectedItem().getKey()==="K"){t.byId("idOrdLbl").setVisible(false);t.byId("idOrdr").setVisible(false);if(t.byId("idOrdr").getValue()){t.byId("idOrdr").setValue("")}t.byId("idGbsLbl").setVisible(false);t.byId("idGbs").setVisible(false);if(t.byId("idGbs").getValue()){t.byId("idGbs").setValue("")}t.byId("idCstCntreLbl").setVisible(true);t.byId("idCstCntre").setVisible(true)}else{t.byId("idOrdLbl").setVisible(false);t.byId("idOrdr").setVisible(false);if(t.byId("idOrdr").getValue()){t.byId("idOrdr").setValue("")}t.byId("idCstCntreLbl").setVisible(false);t.byId("idCstCntre").setVisible(false);if(t.byId("idCstCntre").getValue()){t.byId("idCstCntre").setValue("")}t.byId("idGbsLbl").setVisible(true);t.byId("idGbs").setVisible(true)}},shrtTxtLiveChnge:function(e){var t=this.getView();t.byId("idShrtTxt").setValueState("None");var r=e.getParameters().value;var s=r;if(s){e.getSource().setValue(s)}else{e.getSource().setDOMValue("")}},purchOrgSelChnge:function(e){var t=sap.ui.getCore();t.byId(e.getSource().getId()).setValueState("None")},purchGrpSelChnge:function(e){},currencySelChnge:function(e){},compCodeSelChnge:function(e){},onPersonalSettingsDialogAdd:function(e){var t=this;var r=sap.ui.getCore();var s=this.getView();var a=this.getOwnerComponent().getModel();var i=true;var l=this.getResourceBundle();var d=[r.byId("idPurchOrg"),r.byId("idPurchGrp"),r.byId("idCurrency"),r.byId("idCompCode")];jQuery.each(d,function(e,t){if(t.getValue()){t.setValueState("None")}else if(!t.getValue()){t.setValueState("Error");i=false}});if(!i){n.alert("Please fill up mandatory fields.")}else{var o=[];var u=[];var g={PerSetHdToItmNav:{results:[]}};var c=r.byId("idCompCode").getSelectedItem().getKey();var b=r.byId("idPurchGrp").getSelectedItem().getKey();var m=r.byId("idPurchOrg").getSelectedItem().getKey();var V=r.byId("idCurrency").getSelectedItem().getKey();var p=s.byId("idTextArea").getValue();var y={Element:"POHeaderProposer    EKORG",Active:m};o.push(y);var S={Element:"POHeaderProposer    EKGRP",Active:b};o.push(S);var P={Element:"POHeaderProposer    WAERS",Active:V};o.push(P);var N={Element:"POHeaderProposer    BUKRS",Active:c};o.push(N);u.push(p);sap.ui.core.BusyIndicator.show();g.Uname=I;g.Action=l.getText("prchsOrdr");for(var w=0;w<o.length;w++){g.PerSetHdToItmNav.results.push(o[w])}h=jQuery.extend(true,{},g);v="";f=jQuery.extend(true,{},u);a.create("/PersonalSettingsHeadSet",g,{success:function(e,r){sap.ui.core.BusyIndicator.hide();t.openPersonalSettingsDialog().close();if(t.getView().byId("idItemsTable").getItems()){for(var s=0;s<t.getView().byId("idItemsTable").getItems().length;s++){var a=t.getView().byId("idItemsTable").getItems()[s].mAggregations.cells[6].getText().split(" ")[0];for(var i=0;i<e.PerSetHdToItmNav.results.length;i++){if(e.PerSetHdToItmNav.results[i].Element.includes("WAERS")){var l=a+" "+e.PerSetHdToItmNav.results[i].Active;t.getView().byId("idItemsTable").getItems()[s].mAggregations.cells[6].setText(l)}}}var d=parseFloat(t.getView().byId("idPoNetValue").getText())+" "+e.PerSetHdToItmNav.results[2].Active;t.getView().byId("idPoNetValue").setText(d)}},error:function(e){sap.ui.core.BusyIndicator.hide()}})}},onVendorDialogClose:function(e){b.show("No new item was selected.");e.getSource().getBinding("items").filter([])},vendorSelectionChange:function(e){var t=e.getSource().getSelectedItem().getKey();var r=e.getSource().getModel("VendorListModelName").getData();var s=r.results.length;for(var a=0;a<s;a++){if(t===r.results[a].Lifnr){this.getView().byId("idVendorName").setValue(r.results[a].Name1)}}this.getView().byId("idNumber").setValueState("None");this.getView().byId("idVendorName").setValueState("None")},partnerSelectionChange:function(e){var t=e.getSource().getSelectedItem().getKey();var r=e.getSource().getModel("PartnerFunctionModelName").getData();var s=r.results.length;for(var a=0;a<s;a++){if(t===r.results[a].Parvw){this.getView().byId("idName").setValue(r.results[a].Vtext)}}},itemFieldValidation:function(e){var t=e.getParameters().value;var r=/^[0-9]{1,5}$/;var s=t;var a=s.match(r);if(a){this.$validExpr=a}if(!a){if(s){var i=this.$validExpr?this.$validExpr.input:"";e.getSource().setValue(i)}return false}else{if(s){var i=this.$validExpr?this.$validExpr.input:"";e.getSource().setValue(i);this.getView().byId("idItem").setValueState("None")}else{e.getSource().setDOMValue("")}return false}},poQutyValidationCheck:function(e){var t=e.getParameters().value;var r=/^\d{0,13}(\.\d{0,3})?$/;var s=t;if(s){s=s.replace(",",".");e.getSource().setValue(s)}var a=s.match(r);if(a){this.$validExpr=a}if(!a){if(s){var i=this.$validExpr?this.$validExpr.input:"";e.getSource().setValue(i)}return false}else{if(s){var i=this.$validExpr?this.$validExpr.input:"";e.getSource().setValue(i);this.getView().byId("idPoQty").setValueState("None")}else{e.getSource().setDOMValue("")}return false}},commonSelectionChange:function(e){var t=e.getSource().getId();var r=this.getView();if(t.includes("idOun")){r.byId("idOun").setValueState("None")}else if(t.includes("idMtrlGrp")){r.byId("idMtrlGrp").setValueState("None")}else if(t.includes("idGlAcc")){r.byId("idGlAcc").setValueState("None")}else if(t.includes("idCstCntre")){r.byId("idCstCntre").setValueState("None")}else if(t.includes("idOrdr")){r.byId("idOrdr").setValueState("None")}else if(t.includes("idGbs")){r.byId("idGbs").setValueState("None")}else if(t.includes("idFunct")){r.byId("idFunct").setValueState("None")}},netPriceValidation:function(e){var t=e.getParameters().value;var r=/^\d{0,11}(\.\d{0,2})?$/;var s=t;if(s){s=s.replace(",",".");e.getSource().setValue(s)}var a=s.match(r);if(a){this.$validExpr=a}if(!a){if(s){var i=this.$validExpr?this.$validExpr.input:"";e.getSource().setValue(i)}return false}else{if(s){var i=this.$validExpr?this.$validExpr.input:"";e.getSource().setValue(i);this.getView().byId("idNetPrice").setValueState("None")}else{e.getSource().setDOMValue("")}return false}},delvDateChange:function(e){var t=e.getSource().getDateValue();var r=this.getView();var s=new Date(t);var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM/dd/yyyy"});var i=a.format(s);r.byId("idDelvDt").setValue(i);r.byId("idDelvDt").setValueState("None")},getPersonalSettingsItems:function(e){var t="";if(v){for(var r=0;r<v.results.length;r++){if(v.results[r].Element.includes(e.toUpperCase())){return v.results[r].Active;break}}}else if(h){for(var s=0;s<h.PerSetHdToItmNav.results.length;s++){if(h.PerSetHdToItmNav.results[s].Element.includes(e.toUpperCase())){return h.PerSetHdToItmNav.results[s].Active;break}}}},formatDate:function(e){var t=new Date(e);var r=String(t.getDate()).padStart(2,"0");var s=String(t.getMonth()+1).padStart(2,"0");var a=t.getFullYear();t=a+s+r;return t},onCheckPress:function(e){var t="X";this.handleSubmitPress(t)},onCancelPress:function(e){var t=this.getView();t.byId("idVendor").setValue("");t.byId("idDocDate").setValue("");t.byId("idPoNetValue").setText("");if(t.byId("idItemsTable").getItems().length){t.byId("idItemsTable").getModel("itemTableModelName").setData([]);t.byId("idItemsTable").getModel("itemTableModelName").refresh()}if(t.byId("idPartnersTable").getItems().length){t.byId("idPartnersTable").getModel("vendorPartnerModelName").setData([]);t.byId("idPartnersTable").getModel("vendorPartnerModelName").refresh()}t.byId("idItem").setValue("");t.byId("idAccAGnmnt").setValue("");t.byId("idShrtTxt").setValue("");t.byId("idPoQty").setValue("");t.byId("idOun").setValue("");t.byId("idNetPrice").setValue("");t.byId("idDelvDt").setValue("");t.byId("idMtrlGrp").setValue("");t.byId("idGlAcc").setValue("");t.byId("idCstCntre").setValue("");t.byId("idOrdr").setValue("");t.byId("idGbs").setValue("");t.byId("idFunct").setValue("");t.byId("idName").setValue("");t.byId("idNumber").setValue("");t.byId("idVendorName").setValue("");t.byId("idApproverName").setValue("");t.byId("idTextArea").setValue("");var r=this.getView().byId("idItemsTable");r.mAggregations.columns[0].getHeader().setSelected(false);var s=this.getView().byId("idPartnersTable");s.mAggregations.columns[0].getHeader().setSelected(false)},checkHeaderText:function(e){if(e){return e}else{return""}},splitItems:function(e){if(e.includes("(")&&e.includes(")")){return e.split("(")[1].split(")")[0]}else{return e}},splitAndTrim:function(e){if(e.includes("(")&&e.includes(")")){return e.split("(")[0].trim()}else{return e}},mandtFldValidationCheck:function(){var e=this.getView();var t=true;var r=this.getResourceBundle();var s=[e.byId("idAccAGnmnt"),e.byId("idOun"),e.byId("idMtrlGrp"),e.byId("idGlAcc"),e.byId("idCstCntre"),e.byId("idOrdr"),e.byId("idGbs")];jQuery.each(s,function(e,r){if(r.getValue().includes("(")&&r.getValue().includes(")")&&r.getProperty("visible")){r.setValueState("None")}else if(!r.getValue().includes("(")&&!r.getValue().includes(")")&&r.getProperty("visible")){r.setValueState("Error");t=false}});return t},onFunctnValueHelpRequest:function(e){var t=this.getOwnerComponent().getModel();var r=this.getResourceBundle();this.selectVendorDialog=new sap.m.SelectDialog({title:r.getText("slctPrtnr"),items:{path:"/PartnerFunctionSet",template:new sap.m.StandardListItem({title:"{Vtext}",description:"{Parvw}"})},search:[this.onFunctnSearch,this],confirm:[this.onFunctnSelection,this],cancel:[this.onVendorDialogClose,this]});this.selectVendorDialog.setModel(t);this.selectVendorDialog.open()},onFunctnSelection:function(e){var t=this.byId("idFunct");var r=this.byId("idName");var s="";var a=this;var i="";var l="";if(e.getParameter("selectedItem")){var d=e.getParameter("selectedItem").getDescription();s=e.getParameter("selectedContexts");s.map(function(e){i=e.getObject().Parvw;l=e.getObject().Vtext});t.setValueState("None");r.setValueState("None");t.setValue(i);r.setValue(l)}else{i=e.getSource().getProperty("value");var o=new sap.ui.model.Filter({path:"Parvw",operator:sap.ui.model.FilterOperator.EQ,value1:i});this.getOwnerComponent().getModel().read("/PartnerFunctionSet",{filters:[o],success:function(e,s){if(!e.results.length){n.alert("No Function available for"+" "+"("+i+")")}t.setValueState("None");r.setValueState("None");a.getView().byId("idFunct").setValue(e.results[0].Parvw);a.getView().byId("idName").setValue(e.results[0].Vtext)},error:function(e){}})}if(!d){t.resetProperty("value")}},handleChange:function(e){var t=e.getSource().getDateValue();var r=new Date(t);var s=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM/dd/yyyy"});var a=s.format(r);this.getView().byId("idDocDate").setValue(a)},handleSubmitPress:function(e){var t=this;var r=true;var s=true;var a=this.getView();var i=a.byId("idVendor").getValue();var l=a.byId("idDocDate").getValue();var d=this.getOwnerComponent().getModel();var o=this.getResourceBundle();var u=a.byId("idItemsTable");var g="";var c="";var b=a.byId("idPartnersTable");var I="";var v="";var h={};var f={};var V={HeadToPartnerNav:{results:[]},HeadToItemNav:{results:[]}};if(i){if(l){if(u.getItems().length){g=u.getModel("itemTableModelName");c=g.getData().results;if(b.getItems().length){I=b.getModel("vendorPartnerModelName");v=I.getData().results}V.Bsart="ZB";V.Lifnr=this.splitItems(a.byId("idVendor").getValue());V.Bedat=this.formatDate(a.byId("idDocDate").getValue());V.Ekorg=this.getPersonalSettingsItems("Ekorg");V.Ekgrp=this.getPersonalSettingsItems("Ekgrp");V.Bukrs=this.getPersonalSettingsItems("Bukrs");V.Waers=this.getPersonalSettingsItems("Waers");V.Tflag="";V.Tdline=a.byId("idTextArea").getValue();if(e==="X"){V.Tflag=e}else{V.Tflag=""}if(u.getItems.length){for(var y=0;y<c.length;y++){f.Ebelp=c[y].Item;f.Knttp=this.splitAndTrim(c[y].AccAssgmt);f.Txz01=c[y].ShortText;f.Menge=c[y].POQty.split(" ")[0];f.Meins=this.splitItems(c[y].OUn);f.Netpr=c[y].NetPrice.split(" ")[0];f.Eeind=this.formatDate(c[y].DelivDate);f.Matkl=this.splitItems(c[y].MatlGroup);f.Sakto=this.splitItems(c[y].GL);if(c[y].Order){f.Aufnr=this.splitItems(c[y].Order);f.Kostl=this.splitItems(c[y].CostCenter)}else if(c[y].CostCenter){f.Kostl=this.splitItems(c[y].CostCenter)}else if(c[y].Gbs){f.PsPosid=c[y].Gbs.split("(")[1].split(")")[0]}V.HeadToItemNav.results.push(f);f={}}}if(b.getItems().length){for(var S=0;S<p.length;S++){for(var P=v.length-1;P>=0;P--){if(p[S].Parvw===v[P].Parvw){v.splice(P,1)}}}if(v.length){for(var N=0;N<v.length;N++){h.Parvw=v[N].Parvw;h.Lifnr=v[N].Lifnr;V.HeadToPartnerNav.results.push(h);h={}}}}sap.ui.core.BusyIndicator.show();d.create("/POHeader101Set",V,{success:function(e,r){sap.ui.core.BusyIndicator.hide();if(e.Approver){t.getView().byId("idApproverName").setValue(e.Approver);for(var s=0;s<p.length;s++){I.getData().results.unshift(p[s])}}else{n.success(o.getText("prchsOrdr2")+" "+e.Ebeln);t.onCancelPress()}},error:function(e){sap.ui.core.BusyIndicator.hide();var r=t.getView().getModel("i18n");var s=!!t.getView().$().closest(".sapUiSizeCompact").length;var a=JSON.parse(e.responseText).error.innererror.errordetails;if(a.length){(new m).handle(a,r,s)}}})}else{n.alert("Please add record to the item table.")}}else{n.alert(o.getText("docDateMsg"))}}else{n.alert(o.getText("vndrSelAlrtMsg"))}}})});